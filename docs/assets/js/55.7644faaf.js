(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{196:function(e,a,s){"use strict";s.r(a);var t=s(0),r=Object(t.a)({},function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"_2-服务发现：eureka-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务发现：eureka-server","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.服务发现：Eureka Server")]),e._v(" "),s("p",[e._v("本节介绍如何设置Eureka服务器。")]),e._v(" "),s("h2",{attrs:{id:"_2-1如何包含eureka服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1如何包含eureka服务器","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.1如何包含Eureka服务器")]),e._v(" "),s("p",[e._v("要在项目中包含Eureka Server，请使用组ID为ID "),s("code",[e._v("org.springframework.cloud")]),e._v("且工件ID为的starter "),s("code",[e._v("spring-cloud-starter-netflix-eureka-server")]),e._v("。有关使用当前Spring Cloud Release Train设置构建系统的详细信息，请参阅"),s("a",{attrs:{href:"https://projects.spring.io/spring-cloud/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Cloud Project页面"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("h2",{attrs:{id:"_2-2如何运行eureka服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2如何运行eureka服务器","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.2如何运行Eureka服务器")]),e._v(" "),s("p",[e._v("以下示例显示了最小的Eureka服务器：")]),e._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@SpringBootApplication")]),e._v(" \n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@EnableEurekaServer")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v("  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Application")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("static")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" main（"),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("String")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" args）"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("SpringApplicationBuilder")]),e._v("（"),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Application")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v("）"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("web（"),s("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("）"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("run（args）"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("     \n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("服务器有一个主页，其中包含用于正常Eureka功能的UI和HTTP API端点"),s("code",[e._v("/eureka/*")]),e._v("。")]),e._v(" "),s("p",[e._v("以下链接有一些Eureka背景阅读："),s("a",{attrs:{href:"https://github.com/cfregly/fluxcapacitor/wiki/NetflixOSS-FAQ#eureka-service-discovery-load-balancer",target:"_blank",rel:"noopener noreferrer"}},[e._v("磁通电容"),s("OutboundLink")],1),e._v("和"),s("a",{attrs:{href:"https://groups.google.com/forum/?fromgroups#!topic/eureka_netflix/g3p2r7gHnN0",target:"_blank",rel:"noopener noreferrer"}},[e._v("谷歌小组讨论"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("img",{attrs:{src:"http://cloud.spring.io/spring-cloud-netflix/single/images/tip.png",alt:"[小费]"}})]),e._v(" "),s("th",[e._v("由于Gradle的依赖项解析规则和缺少父bom功能，取决于"),s("code",[e._v("spring-cloud-starter-netflix-eureka-server")]),e._v("可能导致应用程序启动失败。要解决此问题，请添加Spring Boot Gradle插件并导入Spring cloud starter parent bom，如下所示："),s("strong",[e._v("的build.gradle。")])])])]),e._v(" "),s("tbody",[s("tr",[s("td"),e._v(" "),s("td",[s("code",[e._v('buildscript { dependencies { classpath("org.springframework.boot:spring-boot-gradle-plugin:{spring-boot-docs-version}") } } apply plugin: "spring-boot" dependencyManagement { imports { mavenBom "org.springframework.cloud:spring-cloud-dependencies:{spring-cloud-version}" } }')])])])])]),e._v(" "),s("h2",{attrs:{id:"_2-3高可用性，区域和区域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3高可用性，区域和区域","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.3高可用性，区域和区域")]),e._v(" "),s("p",[e._v("Eureka服务器没有后端存储，但注册表中的服务实例都必须发送心跳以使其注册保持最新（因此可以在内存中完成）。客户端还具有Eureka注册的内存缓存（因此，对于服务的每个请求，他们不必访问注册表）。")]),e._v(" "),s("p",[e._v("默认情况下，每个Eureka服务器也是Eureka客户端，并且需要（至少一个）服务URL来定位对等方。如果您不提供该服务，该服务将运行并正常运行，但它会使您的日志充满了无法向对等方注册的大量噪音。")]),e._v(" "),s("p",[e._v("有关区域和区域的客户端"),s("a",{attrs:{href:"http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#spring-cloud-ribbon",target:"_blank",rel:"noopener noreferrer"}},[e._v("功能区支持的详细信息，"),s("OutboundLink")],1),e._v("请参阅"),s("a",{attrs:{href:"http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#spring-cloud-ribbon",target:"_blank",rel:"noopener noreferrer"}},[e._v("下文"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("h2",{attrs:{id:"_2-4独立模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4独立模式","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.4独立模式")]),e._v(" "),s("p",[e._v("两个缓存（客户端和服务器）和心跳的组合使得独立的Eureka服务器可以非常适应故障，只要有某种监视器或弹性运行时（例如Cloud Foundry）使其保持活动状态。在独立模式下，您可能更愿意关闭客户端行为，以便它不会继续尝试并且无法访问其对等方。以下示例显示如何关闭客户端行为：")]),e._v(" "),s("p",[s("strong",[e._v("application.yml（独立Eureka服务器）。")])]),e._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("8761")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" localhost\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("registerWithEureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("false")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("fetchRegistry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("false")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("serviceUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("//$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("/eureka/\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("请注意，"),s("code",[e._v("serviceUrl")]),e._v("它指向与本地实例相同的主机。")]),e._v(" "),s("h2",{attrs:{id:"_2-5同伴意识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5同伴意识","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.5同伴意识")]),e._v(" "),s("p",[e._v("通过运行多个实例并要求它们相互注册，可以使Eureka更具弹性和可用性。实际上，这是默认行为，因此要使其工作所需要做的就是"),s("code",[e._v("serviceUrl")]),e._v("向对等方添加有效内容，如以下示例所示：")]),e._v(" "),s("p",[s("strong",[e._v("application.yml（两个Peer Aware Eureka服务器）。")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("---\nspring:\n  profiles: peer1\neureka:\n  instance:\n    hostname: peer1\n  client:\n    serviceUrl:\n      defaultZone: http://peer2/eureka/\n\n---\nspring:\n  profiles: peer2\neureka:\n  instance:\n    hostname: peer2\n  client:\n    serviceUrl:\n      defaultZone: http://peer1/eureka/\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br")])]),s("p",[e._v("在前面的示例中，我们有一个YAML文件，可用于在两个主机（"),s("code",[e._v("peer1")]),e._v("和"),s("code",[e._v("peer2")]),e._v("）上运行相同的服务器，方法是在不同的Spring配置文件中运行它。您可以使用此配置通过操作"),s("code",[e._v("/etc/hosts")]),e._v("来解析主机名来测试单个主机上的对等感知（在生产中执行此操作没有太大价值）。实际上，"),s("code",[e._v("eureka.instance.hostname")]),e._v("如果您在知道自己的主机名的计算机上运行，则不需要它（默认情况下，通过使用查找它"),s("code",[e._v("java.net.InetAddress")]),e._v("）。")]),e._v(" "),s("p",[e._v("您可以向系统添加多个对等体，并且只要它们通过至少一个边缘彼此连接，它们就可以在它们之间同步注册。如果对等体在物理上是分开的（在数据中心内或在多个数据中心之间），那么系统原则上可以存在“裂脑”类型的故障。")]),e._v(" "),s("h2",{attrs:{id:"_2-6何时优先选择ip地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-6何时优先选择ip地址","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.6何时优先选择IP地址")]),e._v(" "),s("p",[e._v("在某些情况下，Eureka最好通告服务的IP地址而不是主机名。设置"),s("code",[e._v("eureka.instance.preferIpAddress")]),e._v("为"),s("code",[e._v("true")]),e._v("，当应用程序向eureka注册时，它使用其IP地址而不是其主机名。")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("img",{attrs:{src:"http://cloud.spring.io/spring-cloud-netflix/single/images/tip.png",alt:"[小费]"}})])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("如果Java无法确定主机名，则将IP地址发送给Eureka。只有设置主机名的明确方法是设置"),s("code",[e._v("eureka.instance.hostname")]),e._v("属性。您可以使用环境变量在运行时设置主机名 - 例如，"),s("code",[e._v("eureka.instance.hostname=${HOST_NAME}")]),e._v("。")])])])]),e._v(" "),s("h2",{attrs:{id:"_2-7保护eureka服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-7保护eureka服务器","aria-hidden":"true"}},[e._v("#")]),e._v(" 2.7保护Eureka服务器")]),e._v(" "),s("p",[e._v("只需将Spring Security添加到服务器的类路径中即可保护您的Eureka服务器"),s("code",[e._v("spring-boot-starter-security")]),e._v("。默认情况下，当Spring Security位于类路径上时，它将要求每次向应用程序发送请求时都会发送一个有效的CSRF令牌。Eureka客户端通常不会拥有有效的跨站点请求伪造（CSRF）令牌，您需要为"),s("code",[e._v("/eureka/**")]),e._v("端点禁用此要求。例如：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('@EnableWebSecurity\nclass WebSecurityConfig extends WebSecurityConfigurerAdapter {\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.csrf().ignoringAntMatchers("/eureka/**");\n        super.configure(http);\n    }\n}\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br")])]),s("p",[e._v("有关CSRF的更多信息，请参阅"),s("a",{attrs:{href:"https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Security文档"),s("OutboundLink")],1),e._v("。")]),e._v(" "),s("p",[e._v("可以在Spring Cloud Samples "),s("a",{attrs:{href:"https://github.com/spring-cloud-samples/eureka/tree/Eureka-With-Security",target:"_blank",rel:"noopener noreferrer"}},[e._v("回购中"),s("OutboundLink")],1),e._v("找到演示Eureka Server 。")])])},[],!1,null,null,null);a.default=r.exports}}]);
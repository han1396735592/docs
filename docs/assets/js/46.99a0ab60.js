(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{215:function(e,t,r){"use strict";r.r(t);var s=r(0),n=Object(s.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content"},[e._m(0),e._v(" "),r("p",[e._v("本节介绍如何设置Eureka服务器。")]),e._v(" "),e._m(1),e._v(" "),r("p",[e._v("要在项目中包含Eureka Server，请使用组ID为ID "),r("code",[e._v("org.springframework.cloud")]),e._v("且工件ID为的starter "),r("code",[e._v("spring-cloud-starter-netflix-eureka-server")]),e._v("。有关使用当前Spring Cloud Release Train设置构建系统的详细信息，请参阅"),r("a",{attrs:{href:"https://projects.spring.io/spring-cloud/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Cloud Project页面"),r("OutboundLink")],1),e._v("。")]),e._v(" "),e._m(2),e._v(" "),r("p",[e._v("以下示例显示了最小的Eureka服务器：")]),e._v(" "),e._m(3),e._m(4),e._v(" "),r("p",[e._v("以下链接有一些Eureka背景阅读："),r("a",{attrs:{href:"https://github.com/cfregly/fluxcapacitor/wiki/NetflixOSS-FAQ#eureka-service-discovery-load-balancer",target:"_blank",rel:"noopener noreferrer"}},[e._v("磁通电容"),r("OutboundLink")],1),e._v("和"),r("a",{attrs:{href:"https://groups.google.com/forum/?fromgroups#!topic/eureka_netflix/g3p2r7gHnN0",target:"_blank",rel:"noopener noreferrer"}},[e._v("谷歌小组讨论"),r("OutboundLink")],1),e._v("。")]),e._v(" "),e._m(5),e._v(" "),e._m(6),e._v(" "),r("p",[e._v("Eureka服务器没有后端存储，但注册表中的服务实例都必须发送心跳以使其注册保持最新（因此可以在内存中完成）。客户端还具有Eureka注册的内存缓存（因此，对于服务的每个请求，他们不必访问注册表）。")]),e._v(" "),r("p",[e._v("默认情况下，每个Eureka服务器也是Eureka客户端，并且需要（至少一个）服务URL来定位对等方。如果您不提供该服务，该服务将运行并正常运行，但它会使您的日志充满了无法向对等方注册的大量噪音。")]),e._v(" "),r("p",[e._v("有关区域和区域的客户端"),r("a",{attrs:{href:"http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#spring-cloud-ribbon",target:"_blank",rel:"noopener noreferrer"}},[e._v("功能区支持的详细信息，"),r("OutboundLink")],1),e._v("请参阅"),r("a",{attrs:{href:"http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#spring-cloud-ribbon",target:"_blank",rel:"noopener noreferrer"}},[e._v("下文"),r("OutboundLink")],1),e._v("。")]),e._v(" "),e._m(7),e._v(" "),r("p",[e._v("两个缓存（客户端和服务器）和心跳的组合使得独立的Eureka服务器可以非常适应故障，只要有某种监视器或弹性运行时（例如Cloud Foundry）使其保持活动状态。在独立模式下，您可能更愿意关闭客户端行为，以便它不会继续尝试并且无法访问其对等方。以下示例显示如何关闭客户端行为：")]),e._v(" "),e._m(8),e._v(" "),e._m(9),e._m(10),e._v(" "),e._m(11),e._v(" "),e._m(12),e._v(" "),e._m(13),e._v(" "),e._m(14),e._m(15),e._v(" "),r("p",[e._v("您可以向系统添加多个对等体，并且只要它们通过至少一个边缘彼此连接，它们就可以在它们之间同步注册。如果对等体在物理上是分开的（在数据中心内或在多个数据中心之间），那么系统原则上可以存在“裂脑”类型的故障。")]),e._v(" "),e._m(16),e._v(" "),e._m(17),e._v(" "),e._m(18),e._v(" "),e._m(19),e._v(" "),e._m(20),e._v(" "),e._m(21),r("p",[e._v("有关CSRF的更多信息，请参阅"),r("a",{attrs:{href:"https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring Security文档"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("p",[e._v("可以在Spring Cloud Samples "),r("a",{attrs:{href:"https://github.com/spring-cloud-samples/eureka/tree/Eureka-With-Security",target:"_blank",rel:"noopener noreferrer"}},[e._v("回购中"),r("OutboundLink")],1),e._v("找到演示Eureka Server 。")])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"_2-服务发现：eureka-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务发现：eureka-server","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.服务发现：Eureka Server")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-1如何包含eureka服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1如何包含eureka服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.1如何包含Eureka服务器")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-2如何运行eureka服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2如何运行eureka服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2如何运行Eureka服务器")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"language-java line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-java"}},[r("code",[r("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@SpringBootApplication")]),e._v(" \n"),r("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[e._v("@EnableEurekaServer")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Application")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("static")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" main（String "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" args）"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n         "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("SpringApplicationBuilder")]),e._v("（Application "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v("）"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("web（"),r("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("）"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("run（args）"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" \n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("     \n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("服务器有一个主页，其中包含用于正常Eureka功能的UI和HTTP API端点"),t("code",[this._v("/eureka/*")]),this._v("。")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("table",[r("thead",[r("tr",[r("th",[r("img",{attrs:{src:"http://cloud.spring.io/spring-cloud-netflix/single/images/tip.png",alt:"[小费]"}})]),e._v(" "),r("th",[e._v("由于Gradle的依赖项解析规则和缺少父bom功能，取决于"),r("code",[e._v("spring-cloud-starter-netflix-eureka-server")]),e._v("可能导致应用程序启动失败。要解决此问题，请添加Spring Boot Gradle插件并导入Spring cloud starter parent bom，如下所示："),r("strong",[e._v("的build.gradle。")])])])]),e._v(" "),r("tbody",[r("tr",[r("td"),e._v(" "),r("td",[r("code",[e._v('buildscript { dependencies { classpath("org.springframework.boot:spring-boot-gradle-plugin:{spring-boot-docs-version}") } } apply plugin: "spring-boot" dependencyManagement { imports { mavenBom "org.springframework.cloud:spring-cloud-dependencies:{spring-cloud-version}" } }')])])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-3高可用性，区域和区域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3高可用性，区域和区域","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3高可用性，区域和区域")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-4独立模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4独立模式","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.4独立模式")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("strong",[this._v("application.yml（独立Eureka服务器）。")])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"language-yml line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("server:\n  port: 8761\n\neureka:\n  instance:\n    hostname: localhost\n  client:\n    registerWithEureka: false\n    fetchRegistry: false\n    serviceUrl:\n      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("请注意，"),t("code",[this._v("serviceUrl")]),this._v("它指向与本地实例相同的主机。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-5同伴意识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5同伴意识","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.5同伴意识")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("通过运行多个实例并要求它们相互注册，可以使Eureka更具弹性和可用性。实际上，这是默认行为，因此要使其工作所需要做的就是"),t("code",[this._v("serviceUrl")]),this._v("向对等方添加有效内容，如以下示例所示：")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("strong",[this._v("application.yml（两个Peer Aware Eureka服务器）。")])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("---\nspring:\n  profiles: peer1\neureka:\n  instance:\n    hostname: peer1\n  client:\n    serviceUrl:\n      defaultZone: http://peer2/eureka/\n\n---\nspring:\n  profiles: peer2\neureka:\n  instance:\n    hostname: peer2\n  client:\n    serviceUrl:\n      defaultZone: http://peer1/eureka/\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br")])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("p",[e._v("在前面的示例中，我们有一个YAML文件，可用于在两个主机（"),r("code",[e._v("peer1")]),e._v("和"),r("code",[e._v("peer2")]),e._v("）上运行相同的服务器，方法是在不同的Spring配置文件中运行它。您可以使用此配置通过操作"),r("code",[e._v("/etc/hosts")]),e._v("来解析主机名来测试单个主机上的对等感知（在生产中执行此操作没有太大价值）。实际上，"),r("code",[e._v("eureka.instance.hostname")]),e._v("如果您在知道自己的主机名的计算机上运行，则不需要它（默认情况下，通过使用查找它"),r("code",[e._v("java.net.InetAddress")]),e._v("）。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-6何时优先选择ip地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6何时优先选择ip地址","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.6何时优先选择IP地址")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("在某些情况下，Eureka最好通告服务的IP地址而不是主机名。设置"),t("code",[this._v("eureka.instance.preferIpAddress")]),this._v("为"),t("code",[this._v("true")]),this._v("，当应用程序向eureka注册时，它使用其IP地址而不是其主机名。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("table",[t("thead",[t("tr",[t("th",[t("img",{attrs:{src:"http://cloud.spring.io/spring-cloud-netflix/single/images/tip.png",alt:"[小费]"}})])])]),this._v(" "),t("tbody",[t("tr",[t("td",[this._v("如果Java无法确定主机名，则将IP地址发送给Eureka。只有设置主机名的明确方法是设置"),t("code",[this._v("eureka.instance.hostname")]),this._v("属性。您可以使用环境变量在运行时设置主机名 - 例如，"),t("code",[this._v("eureka.instance.hostname=${HOST_NAME}")]),this._v("。")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"_2-7保护eureka服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-7保护eureka服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.7保护Eureka服务器")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("只需将Spring Security添加到服务器的类路径中即可保护您的Eureka服务器"),t("code",[this._v("spring-boot-starter-security")]),this._v("。默认情况下，当Spring Security位于类路径上时，它将要求每次向应用程序发送请求时都会发送一个有效的CSRF令牌。Eureka客户端通常不会拥有有效的跨站点请求伪造（CSRF）令牌，您需要为"),t("code",[this._v("/eureka/**")]),this._v("端点禁用此要求。例如：")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('@EnableWebSecurity\nclass WebSecurityConfig extends WebSecurityConfigurerAdapter {\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.csrf().ignoringAntMatchers("/eureka/**");\n        super.configure(http);\n    }\n}\n')])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br")])])}],!1,null,null,null);n.options.__file="2.服务发现：Eureka Server.md";t.default=n.exports}}]);
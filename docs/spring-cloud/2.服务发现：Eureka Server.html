<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.服务发现：Eureka Server | My study notes</title>
    <meta name="description" content="我的学习笔记">
    
    
    <link rel="preload" href="/assets/css/0.styles.8c977ac8.css" as="style"><link rel="preload" href="/assets/js/app.31318748.js" as="script"><link rel="preload" href="/assets/js/25.45a8afcd.js" as="script"><link rel="prefetch" href="/assets/js/10.132d8ecc.js"><link rel="prefetch" href="/assets/js/11.ad038741.js"><link rel="prefetch" href="/assets/js/12.0ba135f7.js"><link rel="prefetch" href="/assets/js/13.9dd4aec0.js"><link rel="prefetch" href="/assets/js/14.1a39ed5e.js"><link rel="prefetch" href="/assets/js/15.4bca18eb.js"><link rel="prefetch" href="/assets/js/16.7857ec6c.js"><link rel="prefetch" href="/assets/js/17.30d85047.js"><link rel="prefetch" href="/assets/js/18.27bfd804.js"><link rel="prefetch" href="/assets/js/19.ee17b6ec.js"><link rel="prefetch" href="/assets/js/2.e4c57591.js"><link rel="prefetch" href="/assets/js/20.4a5cdf3c.js"><link rel="prefetch" href="/assets/js/21.3ad2a3bd.js"><link rel="prefetch" href="/assets/js/22.a3d2d687.js"><link rel="prefetch" href="/assets/js/23.1a141cdb.js"><link rel="prefetch" href="/assets/js/24.f55ff1c2.js"><link rel="prefetch" href="/assets/js/26.277384c0.js"><link rel="prefetch" href="/assets/js/27.e1a96eba.js"><link rel="prefetch" href="/assets/js/28.9b742315.js"><link rel="prefetch" href="/assets/js/29.85462125.js"><link rel="prefetch" href="/assets/js/3.378533e8.js"><link rel="prefetch" href="/assets/js/30.be560262.js"><link rel="prefetch" href="/assets/js/31.c5339f48.js"><link rel="prefetch" href="/assets/js/4.8ce07562.js"><link rel="prefetch" href="/assets/js/5.0eed9b6e.js"><link rel="prefetch" href="/assets/js/6.e1a17415.js"><link rel="prefetch" href="/assets/js/7.8e5ee205.js"><link rel="prefetch" href="/assets/js/8.6f5053d6.js"><link rel="prefetch" href="/assets/js/9.507db38b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8c977ac8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">My study notes</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/catalogue.html" class="nav-link">目录</a></div> <a href="https://github.com/han1396735592/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    贡献代码！
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/catalogue.html" class="nav-link">目录</a></div> <a href="https://github.com/han1396735592/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    贡献代码！
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>快速链接</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/linux/无密登录.html" class="sidebar-link">linux无密码登录</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>java</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>docker</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>spring boot</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>spring mvc</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="_2-服务发现：eureka-server"><a href="#_2-服务发现：eureka-server" aria-hidden="true" class="header-anchor">#</a> 2.服务发现：Eureka Server</h1> <p>本节介绍如何设置Eureka服务器。</p> <h2 id="_2-1如何包含eureka服务器"><a href="#_2-1如何包含eureka服务器" aria-hidden="true" class="header-anchor">#</a> 2.1如何包含Eureka服务器</h2> <p>要在项目中包含Eureka Server，请使用组ID为ID <code>org.springframework.cloud</code>且工件ID为的starter <code>spring-cloud-starter-netflix-eureka-server</code>。有关使用当前Spring Cloud Release Train设置构建系统的详细信息，请参阅<a href="https://projects.spring.io/spring-cloud/" target="_blank" rel="noopener noreferrer">Spring Cloud Project页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="_2-2如何运行eureka服务器"><a href="#_2-2如何运行eureka服务器" aria-hidden="true" class="header-anchor">#</a> 2.2如何运行Eureka服务器</h2> <p>以下示例显示了最小的Eureka服务器：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span> 
<span class="token annotation punctuation">@EnableEurekaServer</span>
<span class="token keyword">public</span>  <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> main（String <span class="token punctuation">[</span><span class="token punctuation">]</span> args）<span class="token punctuation">{</span>
         <span class="token keyword">new</span> <span class="token class-name">SpringApplicationBuilder</span>（Application <span class="token punctuation">.</span><span class="token keyword">class</span>）<span class="token punctuation">.</span>web（<span class="token boolean">true</span>）<span class="token punctuation">.</span>run（args）<span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>     
</code></pre></div><p>服务器有一个主页，其中包含用于正常Eureka功能的UI和HTTP API端点<code>/eureka/*</code>。</p> <p>以下链接有一些Eureka背景阅读：<a href="https://github.com/cfregly/fluxcapacitor/wiki/NetflixOSS-FAQ#eureka-service-discovery-load-balancer" target="_blank" rel="noopener noreferrer">磁通电容<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://groups.google.com/forum/?fromgroups#!topic/eureka_netflix/g3p2r7gHnN0" target="_blank" rel="noopener noreferrer">谷歌小组讨论<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <table><thead><tr><th><img src="http://cloud.spring.io/spring-cloud-netflix/single/images/tip.png" alt="[小费]"></th> <th>由于Gradle的依赖项解析规则和缺少父bom功能，取决于<code>spring-cloud-starter-netflix-eureka-server</code>可能导致应用程序启动失败。要解决此问题，请添加Spring Boot Gradle插件并导入Spring cloud starter parent bom，如下所示：<strong>的build.gradle。</strong></th></tr></thead> <tbody><tr><td></td> <td><code>buildscript { dependencies { classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:{spring-boot-docs-version}&quot;) } } apply plugin: &quot;spring-boot&quot; dependencyManagement { imports { mavenBom &quot;org.springframework.cloud:spring-cloud-dependencies:{spring-cloud-version}&quot; } }</code></td></tr></tbody></table> <h2 id="_2-3高可用性，区域和区域"><a href="#_2-3高可用性，区域和区域" aria-hidden="true" class="header-anchor">#</a> 2.3高可用性，区域和区域</h2> <p>Eureka服务器没有后端存储，但注册表中的服务实例都必须发送心跳以使其注册保持最新（因此可以在内存中完成）。客户端还具有Eureka注册的内存缓存（因此，对于服务的每个请求，他们不必访问注册表）。</p> <p>默认情况下，每个Eureka服务器也是Eureka客户端，并且需要（至少一个）服务URL来定位对等方。如果您不提供该服务，该服务将运行并正常运行，但它会使您的日志充满了无法向对等方注册的大量噪音。</p> <p>有关区域和区域的客户端<a href="http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#spring-cloud-ribbon" target="_blank" rel="noopener noreferrer">功能区支持的详细信息，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>请参阅<a href="http://cloud.spring.io/spring-cloud-netflix/single/spring-cloud-netflix.html#spring-cloud-ribbon" target="_blank" rel="noopener noreferrer">下文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="_2-4独立模式"><a href="#_2-4独立模式" aria-hidden="true" class="header-anchor">#</a> 2.4独立模式</h2> <p>两个缓存（客户端和服务器）和心跳的组合使得独立的Eureka服务器可以非常适应故障，只要有某种监视器或弹性运行时（例如Cloud Foundry）使其保持活动状态。在独立模式下，您可能更愿意关闭客户端行为，以便它不会继续尝试并且无法访问其对等方。以下示例显示如何关闭客户端行为：</p> <p><strong>application.yml（独立Eureka服务器）。</strong></p> <div class="language-yml extra-class"><pre class="language-text"><code>server:
  port: 8761

eureka:
  instance:
    hostname: localhost
  client:
    registerWithEureka: false
    fetchRegistry: false
    serviceUrl:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/
</code></pre></div><p>请注意，<code>serviceUrl</code>它指向与本地实例相同的主机。</p> <h2 id="_2-5同伴意识"><a href="#_2-5同伴意识" aria-hidden="true" class="header-anchor">#</a> 2.5同伴意识</h2> <p>通过运行多个实例并要求它们相互注册，可以使Eureka更具弹性和可用性。实际上，这是默认行为，因此要使其工作所需要做的就是<code>serviceUrl</code>向对等方添加有效内容，如以下示例所示：</p> <p><strong>application.yml（两个Peer Aware Eureka服务器）。</strong></p> <div class="language- extra-class"><pre class="language-text"><code>---
spring:
  profiles: peer1
eureka:
  instance:
    hostname: peer1
  client:
    serviceUrl:
      defaultZone: http://peer2/eureka/

---
spring:
  profiles: peer2
eureka:
  instance:
    hostname: peer2
  client:
    serviceUrl:
      defaultZone: http://peer1/eureka/
</code></pre></div><p>在前面的示例中，我们有一个YAML文件，可用于在两个主机（<code>peer1</code>和<code>peer2</code>）上运行相同的服务器，方法是在不同的Spring配置文件中运行它。您可以使用此配置通过操作<code>/etc/hosts</code>来解析主机名来测试单个主机上的对等感知（在生产中执行此操作没有太大价值）。实际上，<code>eureka.instance.hostname</code>如果您在知道自己的主机名的计算机上运行，则不需要它（默认情况下，通过使用查找它<code>java.net.InetAddress</code>）。</p> <p>您可以向系统添加多个对等体，并且只要它们通过至少一个边缘彼此连接，它们就可以在它们之间同步注册。如果对等体在物理上是分开的（在数据中心内或在多个数据中心之间），那么系统原则上可以存在“裂脑”类型的故障。</p> <h2 id="_2-6何时优先选择ip地址"><a href="#_2-6何时优先选择ip地址" aria-hidden="true" class="header-anchor">#</a> 2.6何时优先选择IP地址</h2> <p>在某些情况下，Eureka最好通告服务的IP地址而不是主机名。设置<code>eureka.instance.preferIpAddress</code>为<code>true</code>，当应用程序向eureka注册时，它使用其IP地址而不是其主机名。</p> <table><thead><tr><th><img src="http://cloud.spring.io/spring-cloud-netflix/single/images/tip.png" alt="[小费]"></th></tr></thead> <tbody><tr><td>如果Java无法确定主机名，则将IP地址发送给Eureka。只有设置主机名的明确方法是设置<code>eureka.instance.hostname</code>属性。您可以使用环境变量在运行时设置主机名 - 例如，<code>eureka.instance.hostname=${HOST_NAME}</code>。</td></tr></tbody></table> <h2 id="_2-7保护eureka服务器"><a href="#_2-7保护eureka服务器" aria-hidden="true" class="header-anchor">#</a> 2.7保护Eureka服务器</h2> <p>只需将Spring Security添加到服务器的类路径中即可保护您的Eureka服务器<code>spring-boot-starter-security</code>。默认情况下，当Spring Security位于类路径上时，它将要求每次向应用程序发送请求时都会发送一个有效的CSRF令牌。Eureka客户端通常不会拥有有效的跨站点请求伪造（CSRF）令牌，您需要为<code>/eureka/**</code>端点禁用此要求。例如：</p> <div class="language- extra-class"><pre class="language-text"><code>@EnableWebSecurity
class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().ignoringAntMatchers(&quot;/eureka/**&quot;);
        super.configure(http);
    }
}
</code></pre></div><p>有关CSRF的更多信息，请参阅<a href="https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf" target="_blank" rel="noopener noreferrer">Spring Security文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>可以在Spring Cloud Samples <a href="https://github.com/spring-cloud-samples/eureka/tree/Eureka-With-Security" target="_blank" rel="noopener noreferrer">回购中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>找到演示Eureka Server 。</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/han1396735592/docs/edit/master/spring-cloud/2.服务发现：Eureka Server.md" target="_blank" rel="noopener noreferrer">帮助我们改进页面内容！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.31318748.js" defer></script><script src="/assets/js/25.45a8afcd.js" defer></script>
  </body>
</html>
